import streamlit as st
import streamlit.components.v1 as components

# ==========================================
# ğŸ‘‡ GitHub è¨­å®š
# ==========================================
GITHUB_USER = "ShadowREddd"
REPO_NAME = "-"
BRANCH_NAME = "main"
BASE_URL = f"https://raw.githubusercontent.com/{GITHUB_USER}/{REPO_NAME}/{BRANCH_NAME}/"
# ==========================================

st.set_page_config(page_title="é£Ÿéš›è¡Œå‹•å®¶(æ‰‹æ©Ÿç‰ˆ)", layout="wide", initial_sidebar_state="collapsed")

html_code = """
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* --- æ‰‹æ©Ÿç‰ˆæ ¸å¿ƒæ¨£å¼ --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f5f5f5; margin: 0; padding-bottom: 80px; user-select: none; }
        
        /* åº•éƒ¨å°è¦½åˆ— (App é¢¨æ ¼) */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 65px; background: white;
            display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 5000; border-top: 1px solid #eee;
        }
        .nav-item { flex: 1; text-align: center; color: #999; font-size: 0.75rem; background:none; border:none; }
        .nav-item.active { color: #d9534f; font-weight: bold; }
        .nav-icon { font-size: 1.4rem; display: block; margin-bottom: 2px; }

        /* é é¢åˆ‡æ› */
        .page { display: none; padding: 15px; animation: fadeInUp 0.3s; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* å•†å“ç¶²æ ¼ (æ‰‹æ©Ÿé›™æ¬„) */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .card { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .card-img { width: 100%; height: 150px; object-fit: cover; }
        .card-body { padding: 10px; }
        .card-title { font-size: 0.95rem; font-weight: bold; margin-bottom: 5px; color: #333; }
        .price { color: #d9534f; font-weight: bold; font-size: 1rem; }

        /* è©³æƒ…é  (æ»¿ç‰ˆåœ–) */
        .detail-hero img { width: 100%; height: 300px; object-fit: cover; }
        .detail-info { background: white; padding: 20px; border-radius: 20px 20px 0 0; margin-top: -20px; position: relative; min-height: 50vh; }
        
        /* å½ˆè·³è¦–çª— (ç”±ä¸‹å¾€ä¸Šæ»‘å‡º Bottom Sheet) */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 6000; align-items: flex-end; }
        .modal-content { background: white; width: 100%; max-height: 80vh; border-radius: 20px 20px 0 0; padding: 20px; animation: slideUp 0.3s; display: flex; flex-direction: column; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        /* æŒ‰éˆ• */
        .btn { width: 100%; padding: 12px; border-radius: 12px; border: none; font-weight: bold; margin-top: 10px; }
        .btn-primary { background: #d9534f; color: white; }
        .btn-outline { background: white; border: 1px solid #ddd; color: #555; }
        
        /* é£Ÿè­œå¡ç‰‡ */
        .recipe-card { background: white; border-radius: 12px; margin-bottom: 15px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; }
        .recipe-img { width: 100px; height: 100px; object-fit: cover; }
        .recipe-info { padding: 10px; flex: 1; }

        /* ç™»å…¥å°é¢ */
        #splash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s; }
        .splash-logo { width: 60%; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(0.95); } 50% { transform: scale(1.05); } 100% { transform: scale(0.95); } }
    </style>
</head>
<body>
    <div id="splash" onclick="this.style.opacity=0; setTimeout(()=>this.style.display='none',500)">
        <img src="images/é£Ÿéš›è¡Œå‹•å®¶.png" class="splash-logo">
        <div style="position:absolute; bottom:50px; color:#999;">è¼•è§¸é–‹å§‹</div>
    </div>

    <div id="page-market" class="page" style="display:block;">
        <h2 style="margin:10px 0; text-align:center;">ç”Ÿé®®å¸‚é›†</h2>
        <div id="grid-products" class="grid"></div>
    </div>

    <div id="page-recipe" class="page">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>é£Ÿè­œç‰†</h2>
            <button class="btn-outline" style="width:auto; padding:5px 15px;" onclick="showCreateRecipe()">ï¼‹ è‡ªè¨‚</button>
        </div>
        <div id="list-recipes"></div>
    </div>

    <div id="page-detail" class="page" style="padding:0;">
        <div class="detail-hero">
            <button onclick="switchTab('market')" style="position:absolute; top:20px; left:20px; width:40px; height:40px; border-radius:50%; background:rgba(255,255,255,0.8); z-index:10;">â†</button>
            <img id="dt-img" src="">
        </div>
        <div class="detail-info">
            <h1 id="dt-name" style="margin:0;"></h1>
            <div id="dt-price" style="color:#d9534f; font-size:1.5rem; font-weight:bold; margin:10px 0;"></div>
            <p style="color:#666;">ç”¢åœ°ï¼š<span id="dt-origin"></span> | ä¿å­˜ï¼š<span id="dt-storage"></span></p>
            <button class="btn btn-primary" onclick="addToCart()">åŠ å…¥è³¼ç‰©è»Š</button>
            <button class="btn btn-outline" onclick="findRecipe()">æ‰¾ç›¸é—œæ–™ç†</button>
        </div>
    </div>

    <div id="modal-cart" class="modal" onclick="if(event.target===this) closeModal('modal-cart')">
        <div class="modal-content">
            <h3>æˆ‘çš„è³¼ç‰©è»Š</h3>
            <div id="cart-list" style="flex:1; overflow-y:auto;"></div>
            <div style="border-top:1px solid #eee; padding-top:10px; margin-top:10px;">
                <div style="display:flex; justify-content:space-between; font-weight:bold;"><span>ç¸½è¨ˆ</span><span id="cart-total">$0</span></div>
                <button class="btn btn-primary" onclick="alert('çµå¸³æˆåŠŸ'); cart=[]; updateCartUI(); closeModal('modal-cart')">çµå¸³</button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-item active" onclick="switchTab('market')" id="nav-market"><span class="nav-icon">ğŸ¥¦</span>å¸‚é›†</button>
        <button class="nav-item" onclick="switchTab('recipe')" id="nav-recipe"><span class="nav-icon">ğŸ‘¨â€ğŸ³</span>é£Ÿè­œ</button>
        <button class="nav-item" onclick="openModal('modal-cart')"><span class="nav-icon">ğŸ›’<span id="cart-badge" style="font-size:0.8rem; color:#d9534f;">0</span></span>è³¼ç‰©è»Š</button>
    </div>

    <script>
        // è³‡æ–™åº«
        const products = [
            {id:"P1", name:"è˜‹æœ", price:139, img:"images/è˜‹æœ.jpg", origin:"ç¾åœ‹", storage:"å†·è—"},
            {id:"P2", name:"é¦™è•‰", price:80, img:"images/é¦™è•‰.jpg", origin:"å°ç£", storage:"å¸¸æº«"},
            {id:"P3", name:"é«˜éº—èœ", price:160, img:"images/é«˜éº—èœ.JPG", origin:"å°ç£", storage:"å†·è—"},
            {id:"P4", name:"ç•ªèŒ„", price:70, img:"images/ç•ªèŒ„.JPG", origin:"å°ç£", storage:"å†·è—"},
            {id:"P5", name:"æ´‹è”¥", price:50, img:"images/æ´‹è”¥.jpg", origin:"ç¾åœ‹", storage:"å¸¸æº«"},
            {id:"P6", name:"åœ°ç“œ", price:190, img:"images/åœ°ç“œ.jpg", origin:"å°ç£", storage:"å¸¸æº«"},
            {id:"P7", name:"æŸ³æ©™", price:120, img:"images/æŸ³æ©™.JPG", origin:"ç¾åœ‹", storage:"å†·è—"},
            {id:"P8", name:"è èœ", price:90, img:"images/è èœ.JPG", origin:"å°ç£", storage:"å†·è—"},
            {id:"P9", name:"èƒ¡è˜¿è””", price:60, img:"images/èƒ¡è˜¿è””.jpg", origin:"éŸ“åœ‹", storage:"å†·è—"},
            {id:"P10", name:"é³³æ¢¨", price:155, img:"images/é³³æ¢¨.jpg", origin:"ç¾åœ‹", storage:"å†·å‡"}
        ];
        
        let recipes = [
            {id:"R1", name:"ç¶œåˆæ²™æ‹‰", img:"images/ç¶œåˆè”¬æœæ²™æ‹‰.jpg", cal:220, steps:"åˆ‡å¡Šæ‹Œå‹»"},
            {id:"R2", name:"ç•ªèŒ„é«˜éº—èœ", img:"images/ç•ªèŒ„ç‚’é«˜éº—èœ.jpg", cal:180, steps:"å¤§ç«å¿«ç‚’"},
            {id:"R3", name:"çƒ¤åœ°ç“œ", img:"images/èœ‚èœœçƒ¤åœ°ç“œ.jpg", cal:250, steps:"çƒ¤ç®±200åº¦"},
            {id:"R4", name:"é³³æ¢¨è˜‹æœæ±", img:"images/é³³æ¢¨è˜‹æœæ±.jpg", cal:150, steps:"æ‰“æˆæœæ±"},
            {id:"R5", name:"é¦™è•‰å†°æ²™", img:"images/é¦™è•‰æŸ³æ©™å†°æ²™.jpg", cal:180, steps:"åŠ å†°å¡Šæ‰“å‹»"},
            {id:"R6", name:"çƒ¤è”¬èœ", img:"images/ç¾©å¼çƒ¤è”¬èœ.jpg", cal:200, steps:"æ’’é¹½çƒ¤ç†Ÿ"}
        ];

        let cart = [];
        let currentPid = null;

        // åˆå§‹åŒ–
        function init() {
            // æ¸²æŸ“å•†å“
            document.getElementById('grid-products').innerHTML = products.map(p => `
                <div class="card" onclick="showDetail('${p.id}')">
                    <img src="${p.img}" class="card-img">
                    <div class="card-body">
                        <div class="card-title">${p.name}</div>
                        <div class="price">$${p.price}</div>
                    </div>
                </div>
            `).join('');

            // æ¸²æŸ“é£Ÿè­œ
            renderRecipes();
        }

        function renderRecipes() {
            document.getElementById('list-recipes').innerHTML = recipes.map(r => `
                <div class="recipe-card" onclick="alert('åšæ³•ï¼š' + '${r.steps}')">
                    <img src="${r.img}" class="recipe-img" onerror="this.src='https://via.placeholder.com/100'">
                    <div class="recipe-info">
                        <div style="font-weight:bold;">${r.name}</div>
                        <div style="color:#666; font-size:0.9rem;">ğŸ”¥ ${r.cal} kcal</div>
                        <div style="color:#d9534f; font-size:0.8rem;">é»æ“Šçœ‹åšæ³•</div>
                    </div>
                </div>
            `).join('');
        }

        // é é¢åˆ‡æ›
        function switchTab(tab) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('page-'+tab).style.display = 'block';
            document.getElementById('nav-'+tab).classList.add('active');
            window.scrollTo(0,0);
        }

        function showDetail(pid) {
            currentPid = pid;
            const p = products.find(x => x.id === pid);
            document.getElementById('dt-img').src = p.img;
            document.getElementById('dt-name').innerText = p.name;
            document.getElementById('dt-price').innerText = '$' + p.price;
            document.getElementById('dt-origin').innerText = p.origin;
            document.getElementById('dt-storage').innerText = p.storage;
            
            document.getElementById('page-market').style.display = 'none';
            document.getElementById('page-detail').style.display = 'block';
        }

        function addToCart() {
            if(!currentPid) return;
            const p = products.find(x => x.id === currentPid);
            const item = cart.find(x => x.id === currentPid);
            if(item) item.qty++; else cart.push({id:p.id, name:p.name, price:p.price, qty:1});
            updateCartUI();
            alert('å·²åŠ å…¥è³¼ç‰©è»Š');
        }

        function updateCartUI() {
            const total = cart.reduce((sum, i) => sum + i.price*i.qty, 0);
            const count = cart.reduce((sum, i) => sum + i.qty, 0);
            document.getElementById('cart-badge').innerText = count;
            document.getElementById('cart-total').innerText = '$' + total;
            document.getElementById('cart-list').innerHTML = cart.map(i => `
                <div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #f5f5f5;">
                    <span>${i.name} x ${i.qty}</span><span>$${i.price*i.qty}</span>
                </div>
            `).join('');
        }

        function findRecipe() {
            const p = products.find(x => x.id === currentPid);
            alert('æ­£åœ¨ç‚ºæ‚¨å°‹æ‰¾ã€Œ'+p.name+'ã€çš„é£Ÿè­œ...');
            switchTab('recipe');
        }

        function showCreateRecipe() {
            const name = prompt("è«‹è¼¸å…¥é£Ÿè­œåç¨±ï¼š");
            if(name) {
                recipes.unshift({id:"C"+Date.now(), name:name, img:"https://via.placeholder.com/100", cal:0, steps:"è‡ªè¨‚é£Ÿè­œ"});
                renderRecipes();
            }
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        window.onload = init;
    </script>
</body>
</html>
"""

# æ‰‹æ©Ÿç‰ˆåœ–ç‰‡è·¯å¾‘æ›¿æ›
final_mobile_html = html_code.replace("images/", BASE_URL)
components.html(final_mobile_html, height=1000, scrolling=True)
